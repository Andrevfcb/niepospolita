(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[6],{163:function(e,t,a){"use strict";a.r(t);var n=a(3),i=a(6),r=a.n(i),c=a(12),s=a(2),o=a(1),l=a.n(o),u=(a(99),a(14)),p=a(17),d=a(16),m=a(21),j=a(23),b=a(32),O=a(4),v=a(34),y=a(167),x=a(33),h=a(30),f=a(26),g=a(31),k=a(0);t.default=function(){var e=Object(d.a)(),t=e.isLoading,a=e.error,i=e.sendRequest,w=e.clearError,z=Object(o.useState)(!1),N=Object(s.a)(z,2),_=N[0],S=N[1],T=Object(o.useState)("nie okre\u015blono"),I=Object(s.a)(T,2),C=I[0],V=I[1],P=Object(o.useState)(),q=Object(s.a)(P,2),D=q[0],E=q[1],H=Object(o.useState)(),A=Object(s.a)(H,2),M=A[0],J=A[1],K=Object(o.useState)(!1),R=Object(s.a)(K,2),W=R[0],B=R[1],L=Object(o.useState)(!1),U=Object(s.a)(L,2),Z=U[0],F=U[1],G=Object(o.useState)(!1),Y=Object(s.a)(G,2),Q=Y[0],X=Y[1],$=Object(v.useStripe)(),ee=Object(O.g)(),te=Object(x.a)(),ae=te.today,ne=te.dayId,ie=te.currentHour,re=te.currentMinute,ce=Object(o.useContext)(j.a),se=ce.cartItems,oe=ce.total,le=ce.bonusItem;Object(o.useEffect)((function(){window.scrollTo(0,0);var e=function(){var e=Object(c.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i("".concat("https://niepospolita-restauracja.herokuapp.com","/api/delivery/").concat("617bc3415add00f3c5d37619"));case 3:t=e.sent,S(t.delivery_price.value),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),t=function(){var e=Object(c.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i("".concat("https://niepospolita-restauracja.herokuapp.com","/api/time/"));case 3:t=e.sent,X(t.time),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();e(),t()}),[i]),Object(o.useEffect)((function(){var e,t;if(Q&&ae&&ne&&ie&&re){var a=Q.find((function(e){return e._id===ne})),n=a.time.start.hour,i=a.time.start.minute,r=a.time.end.hour,c=a.time.end.minute;i=a.time.start.minute<10?a.time.start.minute+"0":a.time.start.minute,t=(r+":"+(c=a.time.end.minute<10?a.time.end.minute+"0":a.time.end.minute)).toString(),e=ie>n||ie===n&&re>i?re>45?(ie+2+":00").toString():re>30?(ie+1+":45").toString():re>15?(ie+1+":30").toString():(ie+1+":15").toString():(n+1+":"+i).toString(),(ie>=r||ie===r-1&&re>c)&&B(!0)}e&&t&&(E(new Date("8/3/2017 ".concat(e))),J(new Date("8/3/2017 ".concat(t))))}),[Q,ae,ne,ie,re]);var ue=Object(g.a)({street:{value:"",isValid:!1},local:{value:"",isValid:!1},apartament:{value:null,isValid:!0},zipCode:{value:"",isValid:!1},city:{value:"",isValid:!1},email:{value:"",isValid:!1},phoneNumber:{value:"",isValid:!1},message:{value:null,isValid:!0}},!1),pe=Object(s.a)(ue,2),de=pe[0],me=pe[1],je=function(){var e=Object(c.a)(r.a.mark((function e(t){var a,c,s,o,l,u,p,d,m,j,b;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a=se.map((function(e){return{quantity:e.quantity,name:e.name,price:e.price}})),se&&_&&(c=se.map((function(e){return{quantity:e.quantity,price_data:{currency:"pln",unit_amount:100*e.price,product_data:{name:e.name,description:e.description}}}})),s={quantity:1,price_data:{currency:"pln",unit_amount:100*_,product_data:{name:"op\u0142ata za dow\xf3z"}}},oe>=80&&le?c.push({quantity:1,price_data:{currency:"pln",unit_amount:0,product_data:{name:le.item+" gratis"}}}):oe<=60&&c.push(s)),o={street:de.inputs.street.value,local:de.inputs.local.value,zipCode:de.inputs.zipCode.value,city:de.inputs.city.value},o=de.inputs.apartament.value?Object(n.a)(Object(n.a)({},o),{},{apartament:de.inputs.apartament.value}):Object(n.a)(Object(n.a)({},o),{},{apartament:!1}),l=de.inputs.message.value?de.inputs.message.value:"brak","payment-online"!==t.target.id||W){e.next=20;break}return e.prev=7,e.next=10,i("".concat("https://niepospolita-restauracja.herokuapp.com","/api/checkout/"),"POST",JSON.stringify({line_items:c,customer_email:de.inputs.email.value,message:l,deliveryHour:C.toString(),phone:de.inputs.phoneNumber.value,address:o,productName:"",option:"order"}),{"Content-Type":"application/json"});case 10:return u=e.sent,p=u.sessionId,e.next=14,$.redirectToCheckout({sessionId:p});case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(7);case 18:e.next=35;break;case 20:if("payment-offline"!==t.target.id||W){e.next=35;break}return j=t.target.name,oe&&_&&oe<=60?(d=_+"z\u0142",m=oe+_):(d="dostawa gratis",m=oe),b="brak",le&&oe>80&&(b=le.item),e.prev=25,e.next=28,i("".concat("https://niepospolita-restauracja.herokuapp.com","/api/mail/"),"POST",JSON.stringify({customer_email:de.inputs.email.value,customer_phoneNumber:de.inputs.phoneNumber.value,customer_address:o,customer_items:a,total:m,delivery_info:d,bonusItemName:b,timepickerValue:C,paymentMethod:j}),{"Content-Type":"application/json"});case 28:return e.next=30,ee.push("/success");case 30:window.location.reload(),e.next=35;break;case 33:e.prev=33,e.t1=e.catch(25);case 35:case"end":return e.stop()}}),e,null,[[7,16],[25,33]])})));return function(t){return e.apply(this,arguments)}}();return Object(k.jsxs)(l.a.Fragment,{children:[t&&Object(k.jsx)(p.a,{asOverlay:!0}),Object(k.jsx)(m.a,{error:a,onClear:w}),Object(k.jsxs)("div",{className:"order",children:[Object(k.jsx)("h1",{children:"Uzupe\u0142nij dane do zam\xf3wienia"}),Object(k.jsxs)(b.a,{children:[!W&&Object(k.jsxs)("form",{children:[Object(k.jsxs)("div",{className:"address-street",children:[Object(k.jsx)(f.a,{id:"street",element:"input",type:"text",label:"Ulica",validators:[Object(h.d)()],errorText:"Wprowad\u017a poprawn\u0105 nazw\u0119 ulicy.",onInput:me}),Object(k.jsx)(f.a,{id:"local",element:"input",type:"text",label:"Nr lokalu",validators:[Object(h.d)()],errorText:"Podaj poprawny nr lokalu.",onInput:me}),Object(k.jsx)(f.a,{id:"apartament",element:"input",type:"text",label:"Nr mieszkania",validators:null,initialValid:!0,onInput:me})]}),Object(k.jsxs)("div",{className:"address-city",children:[Object(k.jsx)("div",{className:"address-city__zip",style:{position:"relative"},children:Object(k.jsx)("div",{className:"address-city__zip-input",children:Object(k.jsx)(f.a,{id:"zipCode",element:"input",type:"text",label:"Kod pocztowy",validators:[Object(h.d)()],errorText:"Podaj poprawny kod pocztowy.",onInput:me})})}),Object(k.jsx)("div",{className:"address-city__city",children:Object(k.jsx)(f.a,{id:"city",element:"input",type:"text",label:"Miasto",validators:[Object(h.d)()],errorText:"Podaj poprawn\u0105 nazw\u0119 miasta.",onInput:me})})]}),Object(k.jsx)(f.a,{id:"email",element:"input",type:"email",label:"Email",validators:[Object(h.d)(),h.a],errorText:"Podaj poprawny email.",onInput:me}),Object(k.jsx)(f.a,{id:"phoneNumber",element:"input",type:"text",label:"Numer telefonu",validators:[Object(h.d)()],errorText:"Podaj nr telefonu.",onInput:me}),Object(k.jsx)(f.a,{id:"message",element:"textarea",type:"text",label:"Komentarz do dostawcy",validators:null,initialValid:!0,onInput:me}),Object(k.jsx)("label",{style:{fontWeight:"bold",marginBottom:"0.5rem",minHeight:"28px"},children:"Wybierz oczekiwany czas dowozu:"}),Object(k.jsx)("div",{className:"timepicker",children:Object(k.jsx)(y.a,{placeholder:"wybierz godzin\u0119",format:"HH:mm",step:15,min:D,max:M,onChange:function(e){var t,a;e.target.value?(t=e.target.value.getHours(),(a=e.target.value.getMinutes())<10&&(a="0"+e.target.value.getMinutes()),V(t+":"+a)):V("nie okre\u015blono")}})}),Object(k.jsxs)("div",{children:[Object(k.jsx)(u.a,{disabled:!de.isValid||W,id:"payment-offline",onClick:function(e){e.preventDefault(),F((function(e){return!e}))},isClicked:Z,children:"P\u0141ATNO\u015a\u0106 PRZY ODBIORZE"}),Object(k.jsx)(u.a,{disabled:!de.isValid||W||Z,id:"payment-online",onClick:je,children:"P\u0141ATNO\u015a\u0106 ONLINE"})]}),Z&&Object(k.jsxs)("div",{style:{margin:"1em"},children:[Object(k.jsx)(u.a,{disabled:!de.isValid||W,id:"payment-offline",payment:"karta",onClick:je,children:"P\u0141ATNO\u015a\u0106 KART\u0104"}),Object(k.jsx)(u.a,{disabled:!de.isValid||W,id:"payment-offline",payment:"got\xf3wka",onClick:je,children:"P\u0141ATNO\u015a\u0106 GOT\xd3WK\u0104"})]})]}),W&&Object(k.jsx)("p",{style:{color:"red"},children:"Dzi\u015b ju\u017c nie dowozimy, zapraszamy ponownie."})]})]})]})}},99:function(e,t,a){}}]);
//# sourceMappingURL=6.9d783a71.chunk.js.map
(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[7],{168:function(e,t,a){"use strict";a.r(t);var n=a(19),i=a(6),s=a.n(i),r=a(12),c=a(2),o=a(1),u=a.n(o),l=(a(99),a(16)),p=a(14),d=a(0),b=function(e){var t=e.id,a=e.name,n=e.price,i=e.image,s=e.description,r=e.quantity,l=e.changeClickedProductId,b=e.quantityChange,j=Object(o.useState)(r),m=Object(c.a)(j,2),h=m[0],v=m[1],g=function(e){console.log(e.target.className.includes("fa-minus")),e.target.className.includes("fa-minus")?v(h>1?function(e){return e-1}:1):v(h<9?function(e){return e+1}:9)};return Object(d.jsx)(u.a.Fragment,{children:Object(d.jsxs)("div",{className:"item-card",children:[Object(d.jsx)("div",{className:"item-card__image",children:Object(d.jsx)("img",{src:"".concat("https://niepospolita.s3.eu-central-1.amazonaws.com","/").concat(i),alt:a})}),Object(d.jsxs)("div",{className:"item-card__info",children:[Object(d.jsxs)("p",{className:" name price",children:[Object(d.jsx)("span",{style:{fontWeight:"bold"},children:a}),Object(d.jsxs)("span",{style:{fontWeight:"bold",marginLeft:"0.7em"},children:[n," z\u0142"]})]}),Object(d.jsx)("p",{className:"description",children:s}),Object(d.jsxs)("div",{children:[Object(d.jsx)("span",{style:{color:"white"},children:"Liczba:"}),Object(d.jsx)("span",{class:"fas fa-minus item-quantity__handler",id:t,onClick:function(e){g(e),b(e)}}),Object(d.jsx)("span",{style:{color:"white"},children:h}),Object(d.jsx)("span",{class:"fas fa-plus item-quantity__handler",id:t,onClick:function(e){g(e),b(e)}}),Object(d.jsx)(p.a,{id:t,onClick:l,children:"WYBIERZ"})]})]})]})})},j=a(101),m=a.n(j),h=(a(100),a(34)),v=a(26),g=a(30),f=a(31),O=a(4),y=a(17),x=a(21);t.default=function(){var e=Object(o.useState)({availableHours:[]}),t=Object(c.a)(e,2),a=t[0],i=t[1],u=Object(o.useState)(!1),j=Object(c.a)(u,2),w=j[0],k=j[1],z=Object(o.useState)(""),D=Object(c.a)(z,2),q=D[0],N=D[1],_=Object(o.useState)(new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()+1)),C=Object(c.a)(_,2),S=C[0],V=C[1],I=Object(o.useState)(0),T=Object(c.a)(I,2),W=T[0],H=T[1],M=Object(o.useState)([]),P=Object(c.a)(M,2),Y=P[0],F=P[1],B=Object(o.useState)([]),J=Object(c.a)(B,2),L=J[0],E=J[1],R=Object(o.useState)([]),Z=Object(c.a)(R,2),A=Z[0],G=Z[1],U=Object(l.a)(),K=U.isLoading,Q=U.error,X=U.sendRequest,$=U.clearError,ee=Object(h.useStripe)(),te=Object(O.g)(),ae=Object(f.a)({hour:{value:"",isValid:!1},guests:{value:"",isValid:!1},email:{value:"",isValid:!1},phone:{value:"",isValid:!1}},!1),ne=Object(c.a)(ae,2),ie=ne[0],se=ne[1];Object(o.useEffect)((function(){var e,t=function(){var e=Object(r.a)(s.a.mark((function e(){var t,a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,X("".concat("https://niepospolita-restauracja.herokuapp.com","/api/items/"));case 3:t=e.sent,a=t.items.filter((function(e){return!0===e.special})),E(a),A.length<1&&(n=[],a.map((function(e){var t={id:e._id,name:e.name,quantity:1,price:e.price,chosen:!1,description:e.description};return n.push(t)})),G(n)),e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();S&&(e=S.getDay()-1)<0&&(e=6);var a=function(){var t=Object(r.a)(s.a.mark((function t(){var a,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,X("".concat("https://niepospolita-restauracja.herokuapp.com","/api/reservation"));case 3:a=t.sent,k(a.reservations[0].days[e].available.value),N(a.reservations[0].days[e].available.message),i(a.reservations[0].days[e]),ie.inputs.hour.isValid&&(n=a.reservations[0].days[e].availableHours.find((function(e){return e.hour===parseInt(ie.inputs.hour.value)})),H(n.guests)),t.next=12;break;case 10:t.prev=10,t.t0=t.catch(0);case 12:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(){return t.apply(this,arguments)}}();a(),t()}),[X,S,ie.inputs.hour.isValid,ie.inputs.hour.value]);var re=function(e){e.preventDefault();var t=e.target.value;Y.includes(t)?(F((function(e){return e.filter((function(e){return!(t===e)}))})),e.target.style.background="#b39809",e.target.innerHTML="WYBIERZ",A[t].chosen=!1):(F((function(e){return[].concat(Object(n.a)(e),[t])})),e.target.style.background="#726006",e.target.innerHTML="WYBRANO",A[t].chosen=!0)},ce=function(e){e.preventDefault();var t=Object(n.a)(A);e.target.className.includes("fa-minus")?t[e.target.id].quantity>1?t[e.target.id].quantity--:t[e.target.id].quantity=1:t[e.target.id].quantity<9?t[e.target.id].quantity++:t[e.target.id].quantity=9,G(t)},oe=function(){var e=Object(r.a)(s.a.mark((function e(t){var i,r,c,o,u,l,p,d,b,j,m,h,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),i=0,r=[],L&&A&&A.map((function(e){if(e.chosen&&"payment-online"===t.target.id){var a={quantity:e.quantity,price_data:{currency:"pln",unit_amount:100*e.price,product_data:{name:e.name,description:e.description}}};return r.push(a)}if(e.chosen&&"payment-offline"===t.target.id){var n={quantity:e.quantity,name:e.name,price:e.price};return i+=e.price*e.quantity,r.push(n)}})),c=S.getDate(),o=S.getMonth()+1,u=S.getFullYear(),l="Data: ".concat(c,"/").concat(o,"/").concat(u," - Godzina: ").concat(ie.inputs.hour.value,":00 - liczba os\xf3b: ").concat(ie.inputs.guests.value),p={street:"",local:"",zipCode:"",city:"",message:l},d="",b={value:!0,message:l},(j=a.availableHours.find((function(e){return e.hour===parseInt(ie.inputs.hour.value)}))).guests=j.guests-parseInt(ie.inputs.guests.value),m=Object(n.a)(a.availableHours),e.prev=14,e.next=17,X("".concat("https://niepospolita-restauracja.herokuapp.com","/api/reservation/").concat(a._id),"PATCH",JSON.stringify({available:b,availableHours:m}),{"Content-Type":"application/json"});case 17:e.next=21;break;case 19:e.prev=19,e.t0=e.catch(14);case 21:if("payment-online"!==t.target.id){e.next=35;break}return e.prev=22,e.next=25,X("".concat("https://niepospolita-restauracja.herokuapp.com","/api/checkout/"),"POST",JSON.stringify({line_items:r,customer_email:ie.inputs.email.value,message:l,deliveryHour:"",phone:ie.inputs.phone.value,address:p,productName:d,option:"reservation"}),{"Content-Type":"application/json"});case 25:return h=e.sent,v=h.sessionId,e.next=29,ee.redirectToCheckout({sessionId:v});case 29:e.next=33;break;case 31:e.prev=31,e.t1=e.catch(22);case 33:e.next=46;break;case 35:if("payment-offline"!==t.target.id){e.next=46;break}return e.prev=36,e.next=39,X("".concat("https://niepospolita-restauracja.herokuapp.com","/api/mail/"),"POST",JSON.stringify({customer_email:ie.inputs.email.value,customer_phoneNumber:ie.inputs.phone.value,customer_address:p,customer_items:r,total:i,delivery_info:"",bonusItemName:"",timepickerValue:"",paymentMethod:"",message:l,option:"reservation"}),{"Content-Type":"application/json"});case 39:return e.next=41,te.push("/success");case 41:window.location.reload(),e.next=46;break;case 44:e.prev=44,e.t2=e.catch(36);case 46:case"end":return e.stop()}}),e,null,[[14,19],[22,31],[36,44]])})));return function(t){return e.apply(this,arguments)}}(),ue=L.map((function(e,t){var a;return A.length>0&&(a=A[t].quantity),Object(d.jsx)(b,{id:t,name:e.name,price:e.price,description:e.description,image:e.image,changeClickedProductId:re,quantityChange:ce,quantity:a||1},t)})),le=a.availableHours.filter((function(e){return!(0===e.guests)})).map((function(e){return Object(d.jsxs)("option",{value:e.hour,children:[e.hour,":00"]})})),pe=A.map((function(e){if(e.chosen)return Object(d.jsxs)("p",{style:{color:"white"},children:[e.name," - Ilo\u015b\u0107: ",e.quantity," - Cena: ",e.price*e.quantity," z\u0142"]})}));return Object(d.jsxs)("div",{className:"special",children:[Object(d.jsx)(x.a,{error:Q,onClear:$}),K&&Object(d.jsx)(y.a,{asOverlay:!0}),w&&Object(d.jsxs)("div",{children:[L.length>0&&Object(d.jsxs)("div",{className:"special-items",children:[Object(d.jsx)("h1",{children:"Wybierz menu i zarezerwuj stolik"}),ue]}),Y.length>0&&Object(d.jsxs)("form",{className:"special-reservation",children:[Object(d.jsx)("h2",{style:{margin:"0"},children:"Uzupe\u0142nij dane:"}),Object(d.jsx)("p",{style:{fontWeight:"bold",fontSize:"1.2em"},children:"Wybrano:"}),A&&pe,Object(d.jsx)("label",{style:{fontWeight:"bold",marginBottom:"0.5em",marginTop:"2em",minHeight:"28px",display:"block"},children:"Wybierz dat\u0119:"}),Object(d.jsx)(m.a,{id:"date",selected:S,onChange:function(e){V(e),ie.inputs.hour.value="",ie.inputs.hour.isValid=!1,ie.inputs.guests.value="",ie.inputs.guests.isValid=!1,H(0)},dateFormat:"dd/MM/yyyy",minDate:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()+1),maxDate:new Date((new Date).getFullYear(),(new Date).getMonth(),(new Date).getDate()+10)}),Object(d.jsx)(v.a,{id:"hour",element:"select",name:"select",label:"Wybierz godzin\u0119:",validators:[Object(g.d)()],errorText:"Prosz\u0119 wybra\u0107 godzin\u0119.",onInput:se,options:le}),Object(d.jsx)(v.a,{id:"guests",element:"input",type:"number",label:"Wybierz liczb\u0119 os\xf3b: \n                ".concat(W>0&&ie.inputs.hour.isValid?"(na godzin\u0119 ".concat(ie.inputs.hour.value,":00 maksymalna liczba os\xf3b - ").concat(W,")"):""),validators:[Object(g.c)(0),Object(g.b)(W)],errorText:"Nieprawid\u0142owa liczba os\xf3b",onInput:se,options:le}),Object(d.jsx)(v.a,{id:"email",element:"input",type:"email",label:"Podaj email:",validators:[Object(g.d)()],errorText:"Nieprawid\u0142owy email.",onInput:se}),Object(d.jsx)(v.a,{id:"phone",element:"input",type:"text",label:"Podaj nr telefonu:",validators:[Object(g.d)()],errorText:"Nieprawid\u0142owy nr telefonu.",onInput:se}),Object(d.jsx)(p.a,{id:"payment-offline",onClick:oe,disabled:S&&(!ie.isValid||!ie.inputs.hour.isValid||!ie.inputs.guests.isValid||"0"===ie.inputs.guests.value||Y.length<=0),children:"Zap\u0142a\u0107 na miejscu"}),Object(d.jsx)(p.a,{id:"payment-online",onClick:oe,disabled:S&&(!ie.isValid||!ie.inputs.hour.isValid||!ie.inputs.guests.isValid||"0"===ie.inputs.guests.value||Y.length<=0),children:"Zap\u0142a\u0107 online"})]})]}),!w&&Object(d.jsx)("div",{children:Object(d.jsx)("h2",{style:{marginTop:"5em"},children:q||"Brak mo\u017cliwo\u015bci rezerwacji"})})]})}},99:function(e,t,a){}}]);
//# sourceMappingURL=7.a2861b9f.chunk.js.map
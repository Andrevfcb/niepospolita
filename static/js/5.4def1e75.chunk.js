(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[5],{163:function(e,t,a){"use strict";a.r(t);var n=a(3),r=a(6),i=a.n(r),c=a(12),s=a(2),o=a(1),u=a.n(o),l=(a(99),a(14)),p=a(17),d=a(16),m=a(21),b=a(23),j=a(32),v=a(4),O=a(34),f=a(167),h=a(33),x=a(30),y=a(26),k=a(31),w=a(0);t.default=function(){var e=Object(d.a)(),t=e.isLoading,a=e.error,r=e.sendRequest,g=e.clearError,_=Object(o.useState)(!1),z=Object(s.a)(_,2),N=z[0],S=z[1],T=Object(o.useState)("nie okre\u015blono"),I=Object(s.a)(T,2),C=I[0],V=I[1],P=Object(o.useState)(),q=Object(s.a)(P,2),D=q[0],E=q[1],H=Object(o.useState)(),A=Object(s.a)(H,2),M=A[0],J=A[1],K=Object(o.useState)(!1),R=Object(s.a)(K,2),W=R[0],B=R[1],L=Object(o.useState)(!1),U=Object(s.a)(L,2),Z=U[0],F=U[1],G=Object(o.useState)(!1),Y=Object(s.a)(G,2),Q=Y[0],X=Y[1],$=Object(o.useState)(!1),ee=Object(s.a)($,2),te=ee[0],ae=ee[1],ne=Object(o.useState)(!1),re=Object(s.a)(ne,2),ie=re[0],ce=re[1],se=Object(O.useStripe)(),oe=Object(v.g)(),ue=Object(h.a)(),le=ue.today,pe=ue.dayId,de=ue.currentHour,me=ue.currentMinute,be=Object(o.useContext)(b.a),je=be.cartItems,ve=be.total,Oe=be.bonusItem;Object(o.useEffect)((function(){window.scrollTo(0,0);var e=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r("".concat("https://niepospolita-restauracja.herokuapp.com","/api/delivery/").concat("617bc3415add00f3c5d37619"));case 3:t=e.sent,S(t.delivery_price.value),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),t=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r("".concat("https://niepospolita-restauracja.herokuapp.com","/api/time/"));case 3:t=e.sent,ce(t.time),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),a=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r("".concat("https://niepospolita-restauracja.herokuapp.com","/api/bonus-items/").concat("6183e735434fe163aa0696fa"));case 3:t=e.sent,ae(t.bonus_items_price.value),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),n=function(){var e=Object(c.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r("".concat("https://niepospolita-restauracja.herokuapp.com","/api/bonus-delivery/").concat("6183e76c434fe163aa0696ff"));case 3:t=e.sent,X(t.bonus_delivery_price.value),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(0);case 9:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();e(),t(),a(),n()}),[r]),Object(o.useEffect)((function(){var e,t;if(ie&&le&&pe&&de&&me){var a=ie.find((function(e){return e._id===pe})),n=a.time.start.hour,r=a.time.start.minute,i=a.time.end.hour,c=a.time.end.minute;r=a.time.start.minute<10?a.time.start.minute+"0":a.time.start.minute,t=(i+":"+(c=a.time.end.minute<10?a.time.end.minute+"0":a.time.end.minute)).toString(),e=de>n||de===n&&me>r?me>45?(de+2+":00").toString():me>30?(de+1+":45").toString():me>15?(de+1+":30").toString():(de+1+":15").toString():(n+1+":"+r).toString(),(de>=i||de===i-1&&me>c)&&B(!0)}e&&t&&(E(new Date("8/3/2017 ".concat(e))),J(new Date("8/3/2017 ".concat(t))))}),[ie,le,pe,de,me]);var fe=Object(k.a)({street:{value:"",isValid:!1},local:{value:"",isValid:!1},apartament:{value:null,isValid:!0},zipCode:{value:"",isValid:!1},city:{value:"",isValid:!1},email:{value:"",isValid:!1},phoneNumber:{value:"",isValid:!1},message:{value:null,isValid:!0}},!1),he=Object(s.a)(fe,2),xe=he[0],ye=he[1],ke=function(){var e=Object(c.a)(i.a.mark((function e(t){var a,c,s,o,u,l,p,d,m,b,j;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a=je.map((function(e){return{quantity:e.quantity,name:e.name,price:e.price}})),je&&N&&(c=je.map((function(e){return{quantity:e.quantity,price_data:{currency:"pln",unit_amount:100*e.price,product_data:{name:e.name,description:e.description}}}})),s={quantity:1,price_data:{currency:"pln",unit_amount:100*N,product_data:{name:"op\u0142ata za dow\xf3z"}}},ve<=Q&&c.push(s),ve>=te&&Oe&&c.push({quantity:1,price_data:{currency:"pln",unit_amount:0,product_data:{name:Oe.item+" gratis"}}})),o={street:xe.inputs.street.value,local:xe.inputs.local.value,zipCode:xe.inputs.zipCode.value,city:xe.inputs.city.value},o=xe.inputs.apartament.value?Object(n.a)(Object(n.a)({},o),{},{apartament:xe.inputs.apartament.value}):Object(n.a)(Object(n.a)({},o),{},{apartament:!1}),u=xe.inputs.message.value?xe.inputs.message.value:"brak","payment-online"!==t.target.id||W){e.next=20;break}return e.prev=7,e.next=10,r("".concat("https://niepospolita-restauracja.herokuapp.com","/api/checkout/"),"POST",JSON.stringify({line_items:c,customer_email:xe.inputs.email.value,message:u,deliveryHour:C.toString(),phone:xe.inputs.phoneNumber.value,address:o,productName:"",option:"order"}),{"Content-Type":"application/json"});case 10:return l=e.sent,p=l.sessionId,e.next=14,se.redirectToCheckout({sessionId:p});case 14:e.next=18;break;case 16:e.prev=16,e.t0=e.catch(7);case 18:e.next=35;break;case 20:if("payment-offline"!==t.target.id||W){e.next=35;break}return b=t.target.name,ve&&N&&ve<=Q?(d=N+"z\u0142",m=ve+N):(d="dostawa gratis",m=ve),j="brak",Oe&&ve>te&&(j=Oe.item),e.prev=25,e.next=28,r("".concat("https://niepospolita-restauracja.herokuapp.com","/api/mail/"),"POST",JSON.stringify({customer_email:xe.inputs.email.value,customer_phoneNumber:xe.inputs.phoneNumber.value,customer_address:o,customer_items:a,message:u,total:m,delivery_info:d,bonusItemName:j,timepickerValue:C,paymentMethod:b,option:"order"}),{"Content-Type":"application/json"});case 28:return e.next=30,oe.push("/success");case 30:window.location.reload(),e.next=35;break;case 33:e.prev=33,e.t1=e.catch(25);case 35:case"end":return e.stop()}}),e,null,[[7,16],[25,33]])})));return function(t){return e.apply(this,arguments)}}();return Object(w.jsxs)(u.a.Fragment,{children:[t&&Object(w.jsx)(p.a,{asOverlay:!0}),Object(w.jsx)(m.a,{error:a,onClear:g}),Object(w.jsxs)("div",{className:"order",children:[Object(w.jsx)("h1",{children:"Uzupe\u0142nij dane do zam\xf3wienia"}),Object(w.jsxs)(j.a,{children:[!W&&Object(w.jsxs)("form",{children:[Object(w.jsxs)("div",{className:"address-street",children:[Object(w.jsx)(y.a,{id:"street",element:"input",type:"text",label:"Ulica",validators:[Object(x.b)()],errorText:"Wprowad\u017a poprawn\u0105 nazw\u0119 ulicy.",onInput:ye}),Object(w.jsx)(y.a,{id:"local",element:"input",type:"text",label:"Nr lokalu",validators:[Object(x.b)()],errorText:"Podaj poprawny nr lokalu.",onInput:ye}),Object(w.jsx)(y.a,{id:"apartament",element:"input",type:"text",label:"Nr mieszkania",validators:null,initialValid:!0,onInput:ye})]}),Object(w.jsxs)("div",{className:"address-city",children:[Object(w.jsx)("div",{className:"address-city__zip",style:{position:"relative"},children:Object(w.jsx)("div",{className:"address-city__zip-input",children:Object(w.jsx)(y.a,{id:"zipCode",element:"input",type:"text",label:"Kod pocztowy",validators:[Object(x.b)()],errorText:"Podaj poprawny kod pocztowy.",onInput:ye})})}),Object(w.jsx)("div",{className:"address-city__city",children:Object(w.jsx)(y.a,{id:"city",element:"input",type:"text",label:"Miasto",validators:[Object(x.b)()],errorText:"Podaj poprawn\u0105 nazw\u0119 miasta.",onInput:ye})})]}),Object(w.jsx)(y.a,{id:"email",element:"input",type:"email",label:"Email",validators:[Object(x.b)(),x.a],errorText:"Podaj poprawny email.",onInput:ye}),Object(w.jsx)(y.a,{id:"phoneNumber",element:"input",type:"text",label:"Numer telefonu",validators:[Object(x.b)()],errorText:"Podaj nr telefonu.",onInput:ye}),Object(w.jsx)(y.a,{id:"message",element:"textarea",type:"text",label:"Komentarz do dostawcy",validators:null,initialValid:!0,onInput:ye}),Object(w.jsx)("label",{style:{fontWeight:"bold",marginBottom:"0.5rem",minHeight:"28px"},children:"Wybierz oczekiwany czas dowozu:"}),Object(w.jsx)("div",{className:"timepicker",children:Object(w.jsx)(f.a,{placeholder:"wybierz godzin\u0119",format:"HH:mm",step:15,min:D,max:M,onChange:function(e){var t,a;e.target.value?(t=e.target.value.getHours(),(a=e.target.value.getMinutes())<10&&(a="0"+e.target.value.getMinutes()),V(t+":"+a)):V("nie okre\u015blono")}})}),Object(w.jsxs)("div",{children:[Object(w.jsx)(l.a,{disabled:!xe.isValid||W,id:"payment-offline",onClick:function(e){e.preventDefault(),F((function(e){return!e}))},isClicked:Z,children:"P\u0141ATNO\u015a\u0106 PRZY ODBIORZE"}),Object(w.jsx)(l.a,{disabled:!xe.isValid||W||Z,id:"payment-online",onClick:ke,children:"P\u0141ATNO\u015a\u0106 ONLINE"})]}),Z&&Object(w.jsxs)("div",{style:{margin:"1em"},children:[Object(w.jsx)(l.a,{disabled:!xe.isValid||W,id:"payment-offline",payment:"karta",onClick:ke,children:"P\u0141ATNO\u015a\u0106 KART\u0104"}),Object(w.jsx)(l.a,{disabled:!xe.isValid||W,id:"payment-offline",payment:"got\xf3wka",onClick:ke,children:"P\u0141ATNO\u015a\u0106 GOT\xd3WK\u0104"})]})]}),W&&Object(w.jsx)("p",{style:{color:"red"},children:"Dzi\u015b ju\u017c nie dowozimy, zapraszamy ponownie."})]})]})]})}},99:function(e,t,a){}}]);
//# sourceMappingURL=5.4def1e75.chunk.js.map